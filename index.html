<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Habit Tracker · teal dark</title>
  <!-- Tailwind (light usage) & fonts -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0a0f14;
      --bg-secondary: #111920;
      --card: #151d26;
      --card-hover: #1a242f;
      --border: #243040;
      --fg: #f0f4f8;
      --muted: #6b7d8f;
      --accent: #00d4aa;
      --accent-dim: rgba(0, 212, 170, 0.15);
      --danger: #ff6b6b;
      --warning: #ffd93d;
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: var(--bg);
      color: var(--fg);
      min-height: 100vh;
      margin: 0;
      overflow-x: hidden;
    }

    h1, h2, h3, h4 {
      font-family: 'Space Grotesk', sans-serif;
    }

    .bg-pattern {
      position: fixed;
      inset: 0;
      background: 
        radial-gradient(ellipse 80% 50% at 20% -10%, rgba(0, 212, 170, 0.08) 0%, transparent 50%),
        radial-gradient(ellipse 60% 40% at 80% 100%, rgba(0, 150, 200, 0.06) 0%, transparent 50%),
        var(--bg);
      z-index: -1;
    }

    .grid-overlay {
      position: fixed;
      inset: 0;
      background-image: 
        linear-gradient(rgba(255,255,255,0.02) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255,255,255,0.02) 1px, transparent 1px);
      background-size: 60px 60px;
      z-index: -1;
    }

    .habit-card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 16px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .habit-card:hover {
      background: var(--card-hover);
      border-color: rgba(0, 212, 170, 0.3);
      transform: translateY(-2px);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }

    .day-btn {
      width: 36px;
      height: 36px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: transparent;
      color: var(--muted);
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .day-btn:hover {
      border-color: var(--accent);
      background: var(--accent-dim);
    }

    .day-btn.completed {
      background: var(--accent);
      border-color: var(--accent);
      color: var(--bg);
    }

    .day-btn.today {
      border-color: var(--accent);
      box-shadow: 0 0 0 2px var(--accent-dim);
    }

    .check-animation {
      animation: checkPop 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }

    @keyframes checkPop {
      0% { transform: scale(0.8); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }

    .stat-card {
      background: linear-gradient(135deg, var(--card) 0%, rgba(21, 29, 38, 0.8) 100%);
      border: 1px solid var(--border);
      border-radius: 16px;
      position: relative;
      overflow: hidden;
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--accent), transparent);
    }

    .add-btn {
      background: linear-gradient(135deg, var(--accent) 0%, #00b894 100%);
      color: var(--bg);
      border: none;
      border-radius: 12px;
      padding: 12px 24px;
      font-weight: 600;
      font-family: 'Space Grotesk', sans-serif;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .add-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(0, 212, 170, 0.3);
    }

    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(4px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 100;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .modal {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 32px;
      width: 90%;
      max-width: 420px;
      transform: scale(0.9) translateY(20px);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .modal-overlay.active .modal {
      transform: scale(1) translateY(0);
    }

    .input-field {
      width: 100%;
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 14px 16px;
      color: var(--fg);
      font-size: 15px;
      transition: all 0.2s ease;
    }

    .input-field:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px var(--accent-dim);
    }

    .input-field::placeholder {
      color: var(--muted);
    }

    .streak-badge {
      background: var(--accent-dim);
      color: var(--accent);
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }

    .delete-btn {
      opacity: 0;
      transition: opacity 0.2s ease;
      background: transparent;
      border: none;
      color: var(--danger);
      cursor: pointer;
      padding: 8px;
      border-radius: 8px;
    }

    .habit-card:hover .delete-btn {
      opacity: 1;
    }

    .delete-btn:hover {
      background: rgba(255, 107, 107, 0.1);
    }

    .fade-in {
      animation: fadeIn 0.5s ease forwards;
    }

    .slide-up {
      animation: slideUp 0.5s ease forwards;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes slideUp {
      from { 
        opacity: 0;
        transform: translateY(20px);
      }
      to { 
        opacity: 1;
        transform: translateY(0);
      }
    }

    .stagger-1 { animation-delay: 0.1s; }
    .stagger-2 { animation-delay: 0.2s; }
    .stagger-3 { animation-delay: 0.3s; }
    .stagger-4 { animation-delay: 0.4s; }

    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation-duration: 0.01ms !important;
        transition-duration: 0.01ms !important;
      }
    }

    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: var(--bg-secondary); }
    ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: var(--muted); }
  </style>
</head>
<body>
  <div class="bg-pattern"></div>
  <div class="grid-overlay"></div>

  <div class="max-w-6xl mx-auto px-4 py-8 md:py-12">
    <!-- HEADER -->
    <header class="mb-10 fade-in">
      <div class="flex flex-col md:flex-row md:items-end md:justify-between gap-4">
        <div>
          <p class="text-sm uppercase tracking-widest mb-2" style="color: var(--accent);">Daily Progress</p>
          <h1 class="text-4xl md:text-5xl font-bold tracking-tight">Habit Tracker</h1>
        </div>
        <div class="flex items-center gap-4">
          <div class="text-right">
            <p class="text-sm" style="color: var(--muted);" id="current-date"></p>
            <p class="text-2xl font-bold font-['Space_Grotesk']" id="greeting"></p>
          </div>
          <button class="add-btn" onclick="openModal()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
              <line x1="12" y1="5" x2="12" y2="19"></line>
              <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
            Add Habit
          </button>
        </div>
      </div>
    </header>

    <!-- STATS ROW (4 cards) -->
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-10">
      <div class="stat-card p-5 slide-up stagger-1" style="opacity: 0;">
        <p class="text-xs uppercase tracking-wider mb-1" style="color: var(--muted);">Today</p>
        <p class="text-3xl font-bold" id="today-completed">0/0</p>
        <div class="mt-3 h-1.5 rounded-full overflow-hidden" style="background: var(--border);">
          <div class="h-full rounded-full transition-all duration-500" style="background: var(--accent); width: 0%;" id="today-progress"></div>
        </div>
      </div>
      <div class="stat-card p-5 slide-up stagger-2" style="opacity: 0;">
        <p class="text-xs uppercase tracking-wider mb-1" style="color: var(--muted);">Best Streak</p>
        <p class="text-3xl font-bold" id="best-streak">0</p>
        <p class="text-xs mt-1" style="color: var(--muted);">days</p>
      </div>
      <div class="stat-card p-5 slide-up stagger-3" style="opacity: 0;">
        <p class="text-xs uppercase tracking-wider mb-1" style="color: var(--muted);">This Week</p>
        <p class="text-3xl font-bold" id="week-completion">0%</p>
        <p class="text-xs mt-1" style="color: var(--muted);">completion rate</p>
      </div>
      <div class="stat-card p-5 slide-up stagger-4" style="opacity: 0;">
        <p class="text-xs uppercase tracking-wider mb-1" style="color: var(--muted);">Total Habits</p>
        <p class="text-3xl font-bold" id="total-habits">0</p>
        <p class="text-xs mt-1" style="color: var(--muted);">being tracked</p>
      </div>
    </div>

    <!-- WEEK NAVIGATION: MON..SUN -->
    <div class="flex items-center justify-between mb-6 slide-up" style="opacity: 0; animation-delay: 0.5s;">
      <h2 class="text-xl font-bold">This Week</h2>
      <div class="flex gap-2" id="week-days"></div>
    </div>

    <!-- HABITS CONTAINER (dynamic) -->
    <div class="space-y-4" id="habits-container"></div>

    <!-- EMPTY STATE (hidden if habits exist) -->
    <div class="text-center py-20 slide-up" style="opacity: 0; animation-delay: 0.6s; display: none;" id="empty-state">
      <div class="w-20 h-20 rounded-full mx-auto mb-6 flex items-center justify-center" style="background: var(--accent-dim);">
        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2" stroke-linecap="round">
          <path d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"/>
        </svg>
      </div>
      <h3 class="text-xl font-bold mb-2">No habits yet</h3>
      <p style="color: var(--muted);" class="mb-6">Start building better habits today</p>
      <button class="add-btn mx-auto" onclick="openModal()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
          <line x1="12" y1="5" x2="12" y2="19"></line>
          <line x1="5" y1="12" x2="19" y2="12"></line>
        </svg>
        Create Your First Habit
      </button>
    </div>
  </div>

  <!-- MODAL: ADD HABIT -->
  <div class="modal-overlay" id="modal">
    <div class="modal">
      <h3 class="text-2xl font-bold mb-6">New Habit</h3>
      <form onsubmit="addHabit(event)">
        <div class="mb-4">
          <label class="block text-sm mb-2" style="color: var(--muted);">Habit Name</label>
          <input type="text" class="input-field" id="habit-name" placeholder="e.g., Morning meditation" autocomplete="off" required>
        </div>
        <div class="mb-6">
          <label class="block text-sm mb-2" style="color: var(--muted);">Icon</label>
          <div class="flex gap-2 flex-wrap" id="icon-picker">
            <!-- fitness (default) -->
            <button type="button" class="icon-btn w-12 h-12 rounded-xl border flex items-center justify-center text-xl transition-all" style="border-color: var(--accent); background: var(--accent-dim);" data-icon="fitness" onclick="selectIcon(this)">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6.5 6.5h11M6.5 17.5h11M2 12h4M18 12h4M6 6v12M18 6v12"/></svg>
            </button>
            <button type="button" class="icon-btn w-12 h-12 rounded-xl border flex items-center justify-center text-xl transition-all" style="border-color: var(--border);" data-icon="book" onclick="selectIcon(this)">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>
            </button>
            <button type="button" class="icon-btn w-12 h-12 rounded-xl border flex items-center justify-center text-xl transition-all" style="border-color: var(--border);" data-icon="water" onclick="selectIcon(this)">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"/></svg>
            </button>
            <button type="button" class="icon-btn w-12 h-12 rounded-xl border flex items-center justify-center text-xl transition-all" style="border-color: var(--border);" data-icon="sleep" onclick="selectIcon(this)">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
            </button>
            <button type="button" class="icon-btn w-12 h-12 rounded-xl border flex items-center justify-center text-xl transition-all" style="border-color: var(--border);" data-icon="code" onclick="selectIcon(this)">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>
            </button>
            <button type="button" class="icon-btn w-12 h-12 rounded-xl border flex items-center justify-center text-xl transition-all" style="border-color: var(--border);" data-icon="heart" onclick="selectIcon(this)">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
            </button>
          </div>
        </div>
        <div class="flex gap-3">
          <button type="button" class="flex-1 py-3 rounded-xl font-semibold transition-all" style="background: var(--bg-secondary); border: 1px solid var(--border);" onclick="closeModal()">Cancel</button>
          <button type="submit" class="flex-1 py-3 rounded-xl font-semibold transition-all" style="background: var(--accent); color: var(--bg);">Add Habit</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    (function(){
      "use strict";

      // --- DATA & STATE ---
      let habits = JSON.parse(localStorage.getItem('habits')) || [];
      let selectedIcon = 'fitness';      // default selected
      const weekDays = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];

      // Icon SVGs mapping (consistent, same as in habit card)
      const icons = {
        fitness: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6.5 6.5h11M6.5 17.5h11M2 12h4M18 12h4M6 6v12M18 6v12"/></svg>',
        book: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>',
        water: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"/></svg>',
        sleep: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>',
        code: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>',
        heart: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>'
      };

      // --- HELPER FUNCTIONS ---
      function getWeekDates() {
        const now = new Date();
        const dayOfWeek = now.getDay();
        const monday = new Date(now);
        monday.setDate(now.getDate() - (dayOfWeek === 0 ? 6 : dayOfWeek - 1));
        const dates = [];
        for (let i = 0; i < 7; i++) {
          const date = new Date(monday);
          date.setDate(monday.getDate() + i);
          dates.push(date.toISOString().split('T')[0]);
        }
        return dates;
      }

      // improved streak: count consecutive days including today and backwards until gap
      function calculateStreak(habit) {
        const today = new Date();
        let streak = 0;
        for (let i = 0; i < 365; i++) {   // safety
          const checkDate = new Date(today);
          checkDate.setDate(today.getDate() - i);
          const dateStr = checkDate.toISOString().split('T')[0];
          if (habit.completedDates.includes(dateStr)) {
            streak++;
          } else {
            break;   // gap found
          }
        }
        return streak;
      }

      // --- RENDER FUNCTIONS ---
      function renderWeekDays() {
        const container = document.getElementById('week-days');
        if (!container) return;
        const dates = getWeekDates();
        const todayStr = new Date().toISOString().split('T')[0];
        container.innerHTML = dates.map((date, i) => {
          const dayNum = new Date(date).getDate();
          const isToday = date === todayStr;
          return `<div class="text-center">
            <p class="text-xs mb-1" style="color: var(--muted);">${weekDays[i]}</p>
            <div class="w-8 h-8 rounded-lg flex items-center justify-center text-sm font-medium ${isToday ? 'text-black' : ''}" style="${isToday ? 'background: var(--accent);' : ''}">${dayNum}</div>
          </div>`;
        }).join('');
      }

      function renderHabits() {
        const container = document.getElementById('habits-container');
        const emptyState = document.getElementById('empty-state');
        const dates = getWeekDates();
        const todayStr = new Date().toISOString().split('T')[0];

        if (!habits.length) {
          container.innerHTML = '';
          emptyState.style.display = 'block';
          return;
        }

        emptyState.style.display = 'none';

        container.innerHTML = habits.map((habit, index) => {
          const streak = calculateStreak(habit);
          return `
            <div class="habit-card p-5 slide-up" style="opacity: 0; animation-delay: ${0.1 * (index + 1)}s;">
              <div class="flex items-start justify-between mb-4">
                <div class="flex items-center gap-3">
                  <div class="w-12 h-12 rounded-xl flex items-center justify-center" style="background: var(--accent-dim); color: var(--accent);">
                    ${icons[habit.icon] || icons.fitness}
                  </div>
                  <div>
                    <h3 class="font-semibold text-lg">${escapeHtml(habit.name)}</h3>
                    <div class="flex items-center gap-2 mt-1">
                      ${streak > 0 ? `<span class="streak-badge">${streak} day streak</span>` : ''}
                    </div>
                  </div>
                </div>
                <button class="delete-btn" onclick="deleteHabit('${habit.id}')" aria-label="Delete habit">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                  </svg>
                </button>
              </div>
              <div class="flex gap-2">
                ${dates.map(date => {
                  const isCompleted = habit.completedDates.includes(date);
                  const isToday = date === todayStr;
                  const dayNum = new Date(date).getDate();
                  return `
                    <button 
                      class="day-btn ${isCompleted ? 'completed' : ''} ${isToday ? 'today' : ''}"
                      onclick="toggleDay('${habit.id}', '${date}')"
                      aria-label="${isCompleted ? 'Mark incomplete' : 'Mark complete'}"
                    >
                      ${isCompleted ? '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg>' : dayNum}
                    </button>
                  `;
                }).join('')}
              </div>
            </div>
          `;
        }).join('');
      }

      // simple escape for habit name (XSS safety)
      function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
      }

      function updateStats() {
        const dates = getWeekDates();
        const todayStr = new Date().toISOString().split('T')[0];

        // Today completed
        let todayCompleted = 0;
        habits.forEach(h => { if (h.completedDates.includes(todayStr)) todayCompleted++; });
        document.getElementById('today-completed').textContent = `${todayCompleted}/${habits.length}`;
        const progressPercent = habits.length ? (todayCompleted / habits.length) * 100 : 0;
        document.getElementById('today-progress').style.width = `${progressPercent}%`;

        // Best streak (max of current streaks)
        let bestStreak = 0;
        habits.forEach(h => { bestStreak = Math.max(bestStreak, calculateStreak(h)); });
        document.getElementById('best-streak').textContent = bestStreak;

        // Week completion
        let totalPossible = habits.length * 7;
        let totalCompleted = 0;
        habits.forEach(h => {
          dates.forEach(d => { if (h.completedDates.includes(d)) totalCompleted++; });
        });
        const weekPercent = totalPossible ? Math.round((totalCompleted / totalPossible) * 100) : 0;
        document.getElementById('week-completion').textContent = `${weekPercent}%`;

        // Total habits
        document.getElementById('total-habits').textContent = habits.length;
      }

      // --- ACTIONS ---
      window.toggleDay = function(habitId, date) {
        const habit = habits.find(h => h.id === habitId);
        if (!habit) return;
        const idx = habit.completedDates.indexOf(date);
        if (idx > -1) {
          habit.completedDates.splice(idx, 1);
        } else {
          habit.completedDates.push(date);
        }
        saveHabits();
        renderHabits();
        updateStats();
        // animation class
        setTimeout(() => {
          document.querySelectorAll('.day-btn.completed').forEach(btn => btn.classList.add('check-animation'));
        }, 10);
      };

      window.openModal = function() {
        document.getElementById('modal').classList.add('active');
        document.getElementById('habit-name').focus();
        // reset icon selection to default (fitness)
        selectedIcon = 'fitness';
        document.querySelectorAll('.icon-btn').forEach(btn => {
          if (btn.dataset.icon === 'fitness') {
            btn.style.borderColor = 'var(--accent)';
            btn.style.background = 'var(--accent-dim)';
          } else {
            btn.style.borderColor = 'var(--border)';
            btn.style.background = 'transparent';
          }
        });
      };

      window.closeModal = function() {
        document.getElementById('modal').classList.remove('active');
        document.getElementById('habit-name').value = '';
        // do not reset selection visually – but keep default consistency
      };

      window.selectIcon = function(btn) {
        document.querySelectorAll('.icon-btn').forEach(b => {
          b.style.borderColor = 'var(--border)';
          b.style.background = 'transparent';
        });
        btn.style.borderColor = 'var(--accent)';
        btn.style.background = 'var(--accent-dim)';
        selectedIcon = btn.dataset.icon;
      };

      window.addHabit = function(e) {
        e.preventDefault();
        const nameInput = document.getElementById('habit-name');
        const name = nameInput.value.trim();
        if (!name) return;

        const habit = {
          id: Date.now().toString() + Math.random().toString(36).substring(2, 6),
          name: name,
          icon: selectedIcon,
          completedDates: [],
          createdAt: new Date().toISOString()
        };
        habits.push(habit);
        saveHabits();
        closeModal();
        renderHabits();
        updateStats();
        nameInput.value = '';
      };

      window.deleteHabit = function(habitId) {
        if (!confirm('Delete this habit?')) return;
        habits = habits.filter(h => h.id !== habitId);
        saveHabits();
        renderHabits();
        updateStats();
      };

      function saveHabits() {
        localStorage.setItem('habits', JSON.stringify(habits));
      }

      // date & greeting
      function updateDateTime() {
        const now = new Date();
        const options = { weekday: 'long', month: 'long', day: 'numeric' };
        document.getElementById('current-date').textContent = now.toLocaleDateString('en-US', options);
        const hour = now.getHours();
        let greeting = 'Good evening';
        if (hour < 12) greeting = 'Good morning';
        else if (hour < 18) greeting = 'Good afternoon';
        document.getElementById('greeting').textContent = greeting;
      }

      // initial render
      function init() {
        updateDateTime();
        renderWeekDays();
        renderHabits();
        updateStats();
        setInterval(updateDateTime, 60000);
      }

      // event listeners: modal close on escape & backdrop
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') closeModal();
      });

      const modalEl = document.getElementById('modal');
      modalEl.addEventListener('click', function(e) {
        if (e.target === modalEl) closeModal();
      });

      // make sure icons are correctly displayed on page load
      window.addEventListener('DOMContentLoaded', init);
    })();
  </script>
</body>
</html>